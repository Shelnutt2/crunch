#
# The purpose of this test is to test alter tables
#
# Basic Alter Column Name ALGORITHM=COPY
CREATE TABLE t1 (
column1 integer,
column2 varchar(255)
) ENGINE=crunch CONSOLIDATION_THRESHOLD=20;
INSERT INTO t1 VALUES (1,'aHR0cHM6Ly9naXRodWIuY29tL1NoZWxudXR0Mi9jcnVuY2g='), (3,'dmFsdWUy'), (5,'dmFsdWU');
select column2 FROM t1 ORDER BY column1;
column2
aHR0cHM6Ly9naXRodWIuY29tL1NoZWxudXR0Mi9jcnVuY2g=
dmFsdWUy
dmFsdWU
ALTER TABLE t1 CHANGE COLUMN column2 column2New varchar(255), ALGORITHM=COPY;
select column2New FROM t1 ORDER BY column1;
column2New
aHR0cHM6Ly9naXRodWIuY29tL1NoZWxudXR0Mi9jcnVuY2g=
dmFsdWUy
dmFsdWU
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `column1` int(11) DEFAULT NULL,
  `column2New` varchar(255) DEFAULT NULL
) ENGINE=Crunch DEFAULT CHARSET=latin1 `CONSOLIDATION_THRESHOLD`=20
# Basic Alter Column Shrink Varchar ALGORITHM=COPY
ALTER TABLE t1 MODIFY COLUMN column2New varchar(1), ALGORITHM=COPY;
Warnings:
Warning	1265	Data truncated for column 'column2New' at row 1
Warning	1265	Data truncated for column 'column2New' at row 2
Warning	1265	Data truncated for column 'column2New' at row 3
select column2New FROM t1 ORDER BY column1;
column2New
a
d
d
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `column1` int(11) DEFAULT NULL,
  `column2New` varchar(1) DEFAULT NULL
) ENGINE=Crunch DEFAULT CHARSET=latin1 `CONSOLIDATION_THRESHOLD`=20
# Basic Rename Table
RENAME TABLE t1 TO t1New;
show create table t1New;
Table	Create Table
t1New	CREATE TABLE `t1New` (
  `column1` int(11) DEFAULT NULL,
  `column2New` varchar(1) DEFAULT NULL
) ENGINE=Crunch DEFAULT CHARSET=latin1 `CONSOLIDATION_THRESHOLD`=20
# Alter Table options
ALTER TABLE t1New CONSOLIDATION_THRESHOLD=2, ALGORITHM=COPY;
show create table t1New;
Table	Create Table
t1New	CREATE TABLE `t1New` (
  `column1` int(11) DEFAULT NULL,
  `column2New` varchar(1) DEFAULT NULL
) ENGINE=Crunch DEFAULT CHARSET=latin1 `CONSOLIDATION_THRESHOLD`=2
DROP TABLE t1New;
# Alter Column Name ALGORITHM=INPLACE
CREATE TABLE t1 (
column1 integer,
column2 varchar(255)
) ENGINE=crunch CONSOLIDATION_THRESHOLD=20;
INSERT INTO t1 VALUES (1,'aHR0cHM6Ly9naXRodWIuY29tL1NoZWxudXR0Mi9jcnVuY2g='), (3,'dmFsdWUy'), (5,'dmFsdWU');
select column2 FROM t1 ORDER BY column1;
column2
aHR0cHM6Ly9naXRodWIuY29tL1NoZWxudXR0Mi9jcnVuY2g=
dmFsdWUy
dmFsdWU
ALTER TABLE t1 CHANGE COLUMN column2 column2New varchar(255), ALGORITHM=INPLACE;
select column2New FROM t1 ORDER BY column1;
column2New
aHR0cHM6Ly9naXRodWIuY29tL1NoZWxudXR0Mi9jcnVuY2g=
dmFsdWUy
dmFsdWU
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `column1` int(11) DEFAULT NULL,
  `column2New` varchar(255) DEFAULT NULL
) ENGINE=Crunch DEFAULT CHARSET=latin1 `CONSOLIDATION_THRESHOLD`=20
DROP TABLE t1;
